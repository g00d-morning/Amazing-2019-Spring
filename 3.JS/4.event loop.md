探究JavaScript的底层事件机制

### 为什么JS是单线程:
>1. 此外单线程的话可以提高cpu的利用率,不用频繁的切换线程
> 2. 单线程就是同一个时间只能做一件事,因为js作为浏览器脚本语言,其主要用途就是与用户互动,及操作DOM
如果设计多线程,会带来很复杂的同步问题.比如用户给一个dom添加内容,并删除.这个时候有两个线程,一个线程给dom添加
内容\一个线程删除dom,这时浏览器应该响应哪个线程呢.所以为了避免复杂性,js为单线程.
> 3. H5提出的Web Worker运行js脚本创建多个进程,但是是有限制的:子线程完全受主线程控制,且不得操作dom

### 任务队列概念:
> 单线程意味着所有的任务都是排队进行的,一个接着一个执行.但是像I/O输入输出这种比较耗时的任务,cpu会处于空闲状态,为了提高cpu的利用率,这个时候可以先不管这个耗时任务,挂起这个在等待输入\输出完成的任务,先运行排在后面的任务.于是设计者讲任务分成了两种:  同步任务  异步任务(一般是比较耗时的任务);  
**异步任务:不进入主线程,而是进入任务队列,只有异步任务队列通知主线程,某个异步任务就绪了,可以执行了,该任务就会通知主线程执行.**  
只要主线程空了,就会去执行任务队列

![](http://www.ruanyifeng.com/blogimg/asset/2014/bg2014100802.png)

### 补充一些概念:
**非阻塞**: 代码执行异步任务时,主线程会挂起这个任务,待这个异步任务返回结果时,再根据一定规则去执行相应的回调
宏任务/微任务    
> 宏任务--定时器 *setIntervel()\setTimeout()*   
微任务优先级是高于宏任务的..

javascript代码执行的时候会将不同的变量存于内存中的不同位置  
堆:一些对象,   
栈: 一些基础变量,及对象的指针   

调用方法时,js会生成一个与这个方法对应的执行上下文,执行上下文中存放着这个方法的私有作用域,
并有一根链指向外层作用域,方法的参数,这个作用域中定义的变量及这个作用域的this对象.
同一时间只能执行一个方法,方法被放入执行栈.
一个方法执行时会向执行栈添加执行上下文


